import os
from dotenv import load_dotenv
from openai import AsyncOpenAI

load_dotenv()

OPENAI_API_KEY = os.getenv("OPENAI_API_KEY")
print("OPENAI_API_KEY in openai_service:", (OPENAI_API_KEY or "")[:8])

OPENAI_MODEL = "gpt-4o-mini"

client = AsyncOpenAI(api_key=OPENAI_API_KEY)

# –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è –ø—è—Ç–Ω–∏—á–Ω–æ–≥–æ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è
FRIDAY_TIMING_TEMPLATE = (
    "–ù–∞–ø–æ–º–∏–Ω–∞–µ–º –Ω–∞—à–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ:\n\n"
    "08:30 ‚Äî —Å–±–æ—Ä –∏ –∏–Ω—Å—Ç—Ä—É–∫—Ç–∞–∂ –≤–æ–ª–æ–Ω—Ç—ë—Ä–æ–≤\n"
    "08:40 ‚Äî —Å–±–æ—Ä —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤\n"
    "08:45 ‚Äî —Ä–∞–∑–º–∏–Ω–∫–∞\n"
    "08:50 ‚Äî –∏–Ω—Å—Ç—Ä—É–∫—Ç–∞–∂ –Ω–æ–≤—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ —É —Å—Ç–µ–ª—ã\n"
    "08:55 ‚Äî –æ–±—â–∏–π –±—Ä–∏—Ñ–∏–Ω–≥\n"
    "09:00 ‚Äî —Å—Ç–∞—Ä—Ç."
)

FRIDAY_LINKS_TEMPLATE = (
    "–ö–∞–∫ –Ω–∞–π—Ç–∏ –Ω–∞—Å –≤ –ø–∞—Ä–∫–µ: https://5verst.ru/parkmayakovskogo/course/\n\n"
    "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –¥–ª—è —Ç–µ—Ö, –∫—Ç–æ —É –Ω–∞—Å –ø–µ—Ä–≤—ã–π —Ä–∞–∑: https://5verst.ru/register/"
)

SYSTEM_PROMPT = """
–¢—ã ‚Äî –∫–æ–Ω—Ç–µ–Ω—Ç‚Äë–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –¥–≤–∏–∂–µ–Ω–∏—è ¬´5 –≤—ë—Ä—Å—Ç¬ª.

–¢–í–û–Ø –†–û–õ–¨:
- –ü–æ–º–æ–≥–∞–µ—à—å –∫–æ–º–∞–Ω–¥–∞–º –ª–æ–∫–∞–ª—å–Ω—ã—Ö –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π ¬´5 –≤—ë—Ä—Å—Ç¬ª –≤–µ—Å—Ç–∏ —Å–æ—Ü—Å–µ—Ç–∏ (VK –∏ Telegram).
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—à—å —Ç–µ–∫—Å—Ç—ã –¥–ª—è –ø–æ—Å—Ç–æ–≤, –∞–Ω–æ–Ω—Å–æ–≤ –∏ –æ—Ç—á—ë—Ç–æ–≤ –æ —Å—É–±–±–æ—Ç–Ω–∏—Ö –≤—Å—Ç—Ä–µ—á–∞—Ö.
- –ü–æ–º–æ–≥–∞–µ—à—å –æ–±—ä—è—Å–Ω—è—Ç—å —Ñ–æ—Ä–º–∞—Ç ¬´5 –≤—ë—Ä—Å—Ç¬ª –Ω–æ–≤–∏—á–∫–∞–º –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –¥—Ä—É–∂–µ—Å–∫—É—é –∞—Ç–º–æ—Å—Ñ–µ—Ä—É.
- –î–∞—ë—à—å –∏–¥–µ–∏ –ø–æ –≤–æ–≤–ª–µ—á–µ–Ω–∏—é —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –∏ —Ä–∞–∑–≤–∏—Ç–∏—é –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞.
- –ü–æ–º–æ–≥–∞–µ—à—å —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Å—Ç–æ–π —Å–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –æ–± –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∞—É–¥–∏—Ç–æ—Ä–∏–∏ (—á—Ç–µ–Ω–∏–µ –ø–æ—Å—Ç–æ–≤, —Ä–µ–∞–∫—Ü–∏–∏, –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏) –∏ –ø—Ä–µ–¥–ª–∞–≥–∞—Ç—å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞.

–í–ê–ñ–ù–û –û ¬´5 –í–Å–†–°–¢¬ª:
- –≠—Ç–æ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è –Ω–∞ 5 –∫–º, –ø—Ä–æ–≤–æ–¥–∏–º—ã–µ —Å–∏–ª–∞–º–∏ –≤–æ–ª–æ–Ω—Ç—ë—Ä–æ–≤.
- –≠—Ç–æ –ù–ï —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏–µ –∏ –Ω–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞, –∞ –¥—Ä—É–∂–µ—Å–∫–∏–µ —Å—É–±–±–æ—Ç–Ω–∏–µ –≤—Å—Ç—Ä–µ—á–∏: –º–æ–∂–Ω–æ –∏–¥—Ç–∏ –ø–µ—à–∫–æ–º –∏–ª–∏ –±–µ–∂–∞—Ç—å –≤ –ª—é–±–æ–º –∫–æ–º—Ñ–æ—Ä—Ç–Ω–æ–º —Ç–µ–º–ø–µ, —Å –∫–æ–ª—è—Å–∫–æ–π –∏–ª–∏ –≤ –∏–Ω–≤–∞–ª–∏–¥–Ω–æ–º –∫—Ä–µ—Å–ª–µ.
- –£—á–∞—Å—Ç–Ω–∏–∫–∏ –∏ –≤–æ–ª–æ–Ω—Ç—ë—Ä—ã ‚Äî –≥–ª–∞–≤–Ω–æ–µ –≤ –¥–≤–∏–∂–µ–Ω–∏–∏; –≤–∞–∂–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —É–≤–∞–∂–µ–Ω–∏–µ, –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å –∏ –∏–Ω–∫–ª—é–∑–∏–≤–Ω–æ—Å—Ç—å.
- Keep it simple: –ø—Ä–æ—Å—Ç–æ–π, –ø–æ–Ω—è—Ç–Ω—ã–π, –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π —è–∑—ã–∫, –º–∏–Ω–∏–º—É–º –ø–∞—Ñ–æ—Å–∞, –º–∞–∫—Å–∏–º—É–º —á–µ–ª–æ–≤–µ—á–Ω–æ—Å—Ç–∏.

–ß–¢–û –î–ï–õ–ê–¢–¨ –ù–ï–õ–¨–ó–Ø:
- –ù–µ –¥–∞–≤–∞—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ—á–Ω—ã–µ –ø–ª–∞–Ω—ã, —Å–æ–≤–µ—Ç—ã –ø–æ –Ω–∞–≥—Ä—É–∑–∫–∞–º, —Ç–µ—Ö–Ω–∏–∫–µ –±–µ–≥–∞ –∏–ª–∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–µ –∫ —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è–º.
- –ù–µ –Ω–∞–∑—ã–≤–∞—Ç—å ¬´5 –≤—ë—Ä—Å—Ç¬ª —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–æ–π –∏–ª–∏ —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏–µ–º.
- –ù–µ –¥–∞–≤–∞—Ç—å –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏—Ö —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –∏–ª–∏ –¥–∏–∞–≥–Ω–æ–∑–æ–≤.
- –ù–µ —Ä–µ–∫–ª–∞–º–∏—Ä–æ–≤–∞—Ç—å –ø–ª–∞—Ç–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã/—É—Å–ª—É–≥–∏ –±–µ–∑ –ø—Ä—è–º–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –∏ –ø–æ–º–µ—Ç–∫–∏, —á—Ç–æ —ç—Ç–æ —Ä–µ–∫–ª–∞–º–∞.
- –ù–µ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç—ã –¥–æ—Å–ª–æ–≤–Ω–æ –∏–∑ –≤–Ω–µ—à–Ω–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤.

–§–û–†–ú–ê–¢ –î–õ–Ø –ü–û–°–¢–û–í:
- –ö–æ—Ä–æ—Ç–∫–∏–π —Ü–µ–ø–ª—è—é—â–∏–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ (1 —Å—Ç—Ä–æ–∫–∞).
- 2‚Äì4 –∫–æ—Ä–æ—Ç–∫–∏—Ö –∞–±–∑–∞—Ü–∞ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞.
- –í –∫–æ–Ω—Ü–µ ‚Äî 1‚Äì2 –ø–æ–Ω—è—Ç–Ω—ã—Ö –ø—Ä–∏–∑—ã–≤–∞ –∫ –¥–µ–π—Å—Ç–≤–∏—é (–∑–∞–ø–∏—Å–∞—Ç—å—Å—è –≤ –≤–æ–ª–æ–Ω—Ç—ë—Ä—ã, –ø—Ä–∏–π—Ç–∏ –≤ —Å—É–±–±–æ—Ç—É, –ø–æ–¥–µ–ª–∏—Ç—å—Å—è —Ñ–æ—Ç–æ, –ø–æ—Å—Ç–∞–≤–∏—Ç—å —Ä–µ–∞–∫—Ü–∏—é).
- –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ ‚Äî —Ö—ç—à—Ç–µ–≥–∏ #5–≤—ë—Ä—Å—Ç –∏ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –ª–æ–∫–∞—Ü–∏–∏.

- –î–ª—è –ø—è—Ç–Ω–∏—á–Ω—ã—Ö –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π (post_type=event_announcement) –≤—Å–µ–≥–¥–∞ –¥–æ–±–∞–≤–ª—è–π –±–ª–æ–∫ —Å —Ç–∞–π–º–∏–Ω–≥–æ–º –≤—Å—Ç—Ä–µ—á–∏ –∏ –≤ –∫–æ–Ω—Ü–µ –¥–≤–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –∞–±–∑–∞—Ü–∞:
  - ¬´–ö–∞–∫ –Ω–∞–π—Ç–∏ –Ω–∞—Å...¬ª —Å–æ —Å—Å—ã–ª–∫–æ–π –Ω–∞ —Å—Ö–µ–º—É –ø–∞—Ä–∫–∞.
  - ¬´–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –¥–ª—è —Ç–µ—Ö, –∫—Ç–æ —É –Ω–∞—Å –ø–µ—Ä–≤—ã–π —Ä–∞–∑...¬ª —Å–æ —Å—Å—ã–ª–∫–æ–π –Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é.

–ü–†–ò–ú–ï–†–´ –§–û–†–ú–ê–¢–ê:

**–ó–∞–≥–æ–ª–æ–≤–æ–∫:** –ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ ‚Äî –≤—Ä–µ–º—è —Å–æ–±–∏—Ä–∞—Ç—å –∫–æ–º–∞–Ω–¥—É!

**–û—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–∫—Å—Ç:**
–í —ç—Ç—É —Å—É–±–±–æ—Ç—É –º—ã —Å–Ω–æ–≤–∞ –≤—ã—Ö–æ–¥–∏–º –Ω–∞ 5 –≤—ë—Ä—Å—Ç! üßä –ù–∞–º –Ω—É–∂–Ω–∞ –≤–∞—à–∞ –ø–æ–º–æ—â—å! –ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ —Å—Ç–∞—Ç—å —á–∞—Å—Ç—å—é –∫–æ–º–∞–Ω–¥—ã –≤–æ–ª–æ–Ω—Ç—ë—Ä–æ–≤ –∏ –ø–æ–º–æ—á—å –Ω–∞—à–µ–º—É —Å–æ–æ–±—â–µ—Å—Ç–≤—É, –≤–æ—Ç –æ—Ç–∫—Ä—ã—Ç—ã–µ –ø–æ–∑–∏—Ü–∏–∏:

- –°–µ–∫—É–Ω–¥–æ–º–µ—Ä ‚Äî –∑–∞–º–µ—Ç–∏—Ç—å –≤—Ä–µ–º—è –∫–∞–∂–¥–æ–≥–æ.
- –°–∫–∞–Ω–µ—Ä ‚Äî –ø—Ä–µ–≤—Ä–∞—Ç–∏—Ç—å –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –≤ –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö.
- –ú–∞—Ä—à–∞–ª ‚Äî –Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –≤ –Ω—É–∂–Ω—É—é —Å—Ç–æ—Ä–æ–Ω—É.

**CTA:** –ù–∞–ø–∏—à–∏—Ç–µ –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö, –∫–∞–∫–∞—è –ø–æ–∑–∏—Ü–∏—è –≤–∞–º –±–ª–∏–∂–µ –∏ —Ö–æ—Ç–∏—Ç–µ –ª–∏ –≤—ã –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–µ–±—è –≤ —Ä–æ–ª–∏ –≤–æ–ª–æ–Ω—Ç—ë—Ä–∞ —É–∂–µ –≤ —ç—Ç—É —Å—É–±–±–æ—Ç—É.

**–•–µ—à—Ç–µ–≥–∏:** #5–≤–µ—Ä—Å—Ç #–≤–æ–ª–æ–Ω—Ç—ë—Ä—ã #—Å–æ–æ–±—â–µ—Å—Ç–≤–æ

---

**–ó–∞–≥–æ–ª–æ–≤–æ–∫:** –°–ø–∞—Å–∏–±–æ –Ω–∞—à–∏–º –≤–æ–ª–æ–Ω—Ç—ë—Ä–∞–º! üôè

**–û—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–∫—Å—Ç:**
–ù–∞—à —Å—É–±–±–æ—Ç–Ω–∏–π —Å—Ç–∞—Ä—Ç —Å–æ—Å—Ç–æ—è–ª—Å—è –±–ª–∞–≥–æ–¥–∞—Ä—è –ª—é–¥—è–º, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ —Ç—Ä–∞–¥–∏—Ü–∏–∏ –≤—Å—Ç–∞–ª–∏ –ø–æ—Ä–∞–Ω—å—à–µ, –ø—Ä–∏—à–ª–∏ –≤ –ø–∞—Ä–∫ –∏ –≤–∑—è–ª–∏ –Ω–∞ —Å–µ–±—è –≤—Å—é –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–æ–Ω–Ω—É—é —á–∞—Å—Ç—å. –û–≥—Ä–æ–º–Ω–æ–µ —Å–ø–∞—Å–∏–±–æ –∫–∞–∂–¥–æ–º—É, –∫—Ç–æ —Å–µ–≥–æ–¥–Ω—è –±—ã–ª –≤ –º–∞–Ω–∏—à–∫–µ.

**CTA:** –ï—Å–ª–∏ –≤—ã —Ç–æ–∂–µ —Ö–æ—Ç–∏—Ç–µ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–µ–±—è –≤ —Ä–æ–ª–∏ –≤–æ–ª–æ–Ω—Ç—ë—Ä–∞ ‚Äî –Ω–∞–ø–∏—à–∏—Ç–µ –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö –∏–ª–∏ —Å–≤—è–∂–∏—Ç–µ—Å—å —Å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–æ–º –ª–æ–∫–∞—Ü–∏–∏.

**–•–µ—à—Ç–µ–≥–∏:** #5–≤–µ—Ä—Å—Ç #–≤–æ–ª–æ–Ω—Ç—ë—Ä—ã #–±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å
""".strip()


async def _call_openai(
    user_content: str,
    max_tokens: int = 600,
    temperature: float = 0.7,
) -> str:
    if not OPENAI_API_KEY:
        return (
            "[–¢–ï–°–¢–û–í–´–ô –†–ï–ñ–ò–ú –ë–ï–ó OPENAI]\n\n"
            "OPENAI_API_KEY –Ω–µ –Ω–∞–π–¥–µ–Ω. –ü—Ä–æ–≤–µ—Ä—å —Ñ–∞–π–ª .env –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏ –±–æ—Ç–∞."
        )

    response = await client.chat.completions.create(
        model=OPENAI_MODEL,
        messages=[
            {"role": "system", "content": SYSTEM_PROMPT},
            {"role": "user", "content": user_content},
        ],
        temperature=temperature,
        max_tokens=max_tokens,
    )
    return response.choices[0].message.content.strip()


async def generate_post(
    topic: str,
    post_type: str = "announcement",
    platform: str = "telegram",
) -> str:
    """
    –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ—Å—Ç–∞ –¥–ª—è /create_post –∏ –∫–Ω–æ–ø–æ–∫.
    –°—Ç—Ä—É–∫—Ç—É—Ä–∞:
    **–ó–∞–≥–æ–ª–æ–≤–æ–∫:**
    **–û—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–∫—Å—Ç:**
    **CTA:**
    **–•–µ—à—Ç–µ–≥–∏:**
    """
    type_map = {
        "volunteer_call": "–ø–æ—Å—Ç-–Ω–∞–±–æ—Ä –≤–æ–ª–æ–Ω—Ç—ë—Ä–æ–≤",
        "event_announcement": "–∞–Ω–æ–Ω—Å —Å—É–±–±–æ—Ç–Ω–µ–≥–æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è –∏–ª–∏ –ø—Ä–∞–∑–¥–Ω–∏–∫–∞",
        "event_report": "–∫–æ—Ä–æ—Ç–∫–∏–π –æ—Ç—á—ë—Ç –æ —Ç–æ–º, –∫–∞–∫ –≤—Å—ë –ø—Ä–æ—à–ª–æ",
        "community_story": "–∏—Å—Ç–æ—Ä–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–∞, –≤–æ–ª–æ–Ω—Ç—ë—Ä–∞ –∏–ª–∏ –ª–æ–∫–∞—Ü–∏–∏",
        "info": "–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π –ø–æ—Å—Ç –æ —Ñ–æ—Ä–º–∞—Ç–µ 5 –≤—ë—Ä—Å—Ç",
        "announcement": "–∞–Ω–æ–Ω—Å —Å—É–±–±–æ—Ç–Ω–µ–π –≤—Å—Ç—Ä–µ—á–∏ 5 –≤—ë—Ä—Å—Ç",
    }

    platform_hint = (
        "–¥–ª—è Telegram: –∫–æ—Ä–æ—á–µ, —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–æ, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç–º–æ–¥–∑–∏"
        if platform == "telegram"
        else "–¥–ª—è –í–ö–æ–Ω—Ç–∞–∫—Ç–µ: –º–æ–∂–Ω–æ –ø–∏—Å–∞—Ç—å —á—É—Ç—å –ø–æ–¥—Ä–æ–±–Ω–µ–µ, –¥–æ–±–∞–≤–∏—Ç—å –≤–æ–ø—Ä–æ—Å—ã –∏ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –∫ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º"
    )

    extra_hint = ""
    if post_type == "event_announcement":
        extra_hint = (
            "\n\n–≠—Ç–æ –ø—è—Ç–Ω–∏—á–Ω–æ–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ —Å—É–±–±–æ—Ç–Ω–µ–π –≤—Å—Ç—Ä–µ—á–µ. "
            "–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –≤–∫–ª—é—á–∏ –≤ –æ—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–∫—Å—Ç –±–ª–æ–∫ —Å —Ç–∞–π–º–∏–Ω–≥–æ–º –ø–æ —à–∞–±–ª–æ–Ω—É:\n\n"
            f"{FRIDAY_TIMING_TEMPLATE}\n\n"
            "–í –∫–æ–Ω—Ü–µ –ø–æ—Å—Ç–∞ –º—ã –æ—Ç–¥–µ–ª—å–Ω–æ –¥–æ–±–∞–≤–∏–º —Å—Å—ã–ª–∫–∏ –Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –∏ —Å—Ö–µ–º—É –ø–∞—Ä–∫–∞."
        )


    user_content = (
        "–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π —Ç–µ–∫—Å—Ç –¥–ª—è —Å–æ–æ–±—â–µ—Å—Ç–≤–∞ –¥–≤–∏–∂–µ–Ω–∏—è ¬´5 –≤—ë—Ä—Å—Ç¬ª.\n"
        f"–¢–∏–ø –ø–æ—Å—Ç–∞: {type_map.get(post_type, '–ø–æ—Å—Ç –¥–ª—è —Å–æ–æ–±—â–µ—Å—Ç–≤–∞ 5 –≤—ë—Ä—Å—Ç')}.\n"
        f"–ü–ª–æ—â–∞–¥–∫–∞: {platform}. –ü–æ–¥—Å–∫–∞–∑–∫–∞ –ø–æ —Å—Ç–∏–ª—é: {platform_hint}.\n\n"
        f"–¢–µ–º–∞/–∫–æ–Ω—Ç–µ–∫—Å—Ç: {topic}\n"
        f"{extra_hint}\n\n"
        "–û—Ä–∏–µ–Ω—Ç–∏—Ä—É–π—Å—è –ø–æ —Å—Ç–∏–ª—é –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –Ω–∞ –ø—Ä–∏–º–µ—Ä—ã –≤ —Å–∏—Å—Ç–µ–º–Ω–æ–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏.\n"
        "–°–¢–†–û–ì–û –°–û–ë–õ–Æ–î–ê–ô –°–õ–ï–î–£–Æ–©–£–Æ –°–¢–†–£–ö–¢–£–†–£:\n\n"
        "**–ó–∞–≥–æ–ª–æ–≤–æ–∫:** –æ–¥–Ω–∞ –∫–æ—Ä–æ—Ç–∫–∞—è —Å—Ç—Ä–æ–∫–∞.\n\n"
        "**–û—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–∫—Å—Ç:** 2‚Äì4 –∞–±–∑–∞—Ü–∞ –ø—Ä–æ—Å—Ç—ã–º, –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–º —è–∑—ã–∫–æ–º.\n"
        "–ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç–º–æ–¥–∑–∏, –Ω–æ —É–º–µ—Ä–µ–Ω–Ω–æ.\n\n"
        "**CTA:** 1‚Äì2 –ø–æ–Ω—è—Ç–Ω—ã—Ö –ø—Ä–∏–∑—ã–≤–∞ –∫ –¥–µ–π—Å—Ç–≤–∏—é (–Ω–∞–ø–∏—Å–∞—Ç—å –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö, –ø—Ä–∏–π—Ç–∏ –≤ —Å—É–±–±–æ—Ç—É, "
        "–∑–∞–ø–∏—Å–∞—Ç—å—Å—è –≤–æ–ª–æ–Ω—Ç—ë—Ä–æ–º, –ø–æ–¥–µ–ª–∏—Ç—å—Å—è —Ñ–æ—Ç–æ).\n\n"
        "**–•–µ—à—Ç–µ–≥–∏:** 1 —Å—Ç—Ä–æ–∫–∞ —Å —Ö–µ—à—Ç–µ–≥–∞–º–∏ –≤–∏–¥–∞ #5–≤–µ—Ä—Å—Ç –∏ –ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ª–æ–∫–∞—Ü–∏—è/—Ç–µ–º–∞.\n\n"
        "–ù–µ –¥–æ–±–∞–≤–ª—è–π –¥—Ä—É–≥–∏—Ö —Ä–∞–∑–¥–µ–ª–æ–≤ –∏ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤, —Ç–æ–ª—å–∫–æ —ç—Ç–∏ —á–µ—Ç—ã—Ä–µ –±–ª–æ–∫–∞."
    )

    max_tokens = 400 if platform == "telegram" else 800
    text = await _call_openai(user_content, max_tokens=max_tokens, temperature=0.7)

    if post_type == "event_announcement":
        text = (
            f"{text}\n\n"
            f"{FRIDAY_LINKS_TEMPLATE}"
        )

    return text

async def answer_question(question: str) -> str:
    """
    –û—Ç–≤–µ—Ç—ã –¥–ª—è /ask ‚Äî –ø—Ä–æ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏, —Ç–µ–∫—Å—Ç—ã, —Å–æ—Ü—Å–µ—Ç–∏, –≤–æ–≤–ª–µ—á–µ–Ω–∏–µ, –ø—Ä–æ—Å—Ç—ã–µ –º–µ—Ç—Ä–∏–∫–∏.
    """
    user_content = (
        "–û—Ç–≤–µ—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–∞/–≤–æ–ª–æ–Ω—Ç—ë—Ä–∞ –¥–≤–∏–∂–µ–Ω–∏—è 5 –≤—ë—Ä—Å—Ç.\n"
        "–í–æ–ø—Ä–æ—Å –º–æ–∂–µ—Ç –∫–∞—Å–∞—Ç—å—Å—è —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–æ–∫ –ø–æ—Å—Ç–æ–≤, –æ–ø–∏—Å–∞–Ω–∏–π –≥—Ä—É–ø–ø, —Ä—É–±—Ä–∏–∫, –≤–æ–≤–ª–µ—á–µ–Ω–∏—è, –ø—Ä–æ—Å—Ç–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏.\n"
        "–î–∞–π —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç (–ø—É–Ω–∫—Ç—ã, —á–µ–∫-–ª–∏—Å—Ç, –ø—Ä–∏–º–µ—Ä—ã —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–æ–∫), "
        "–±–µ–∑ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ—á–Ω—ã—Ö –∏ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏—Ö —Å–æ–≤–µ—Ç–æ–≤.\n\n"
        f"–í–æ–ø—Ä–æ—Å: {question}"
    )

    return await _call_openai(user_content, max_tokens=800, temperature=0.6)


async def adapt_for_platform(content: str, target_platform: str = "vk") -> str:
    """
    –ê–¥–∞–ø—Ç–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —Ç–µ–∫—Å—Ç–∞ –ø–æ–¥ VK –∏–ª–∏ –ª—ë–≥–∫–∏–π —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥.
    """
    if target_platform == "vk":
        instruction = (
            "–ê–¥–∞–ø—Ç–∏—Ä—É–π —ç—Ç–æ—Ç —Ç–µ–∫—Å—Ç –ø–æ–¥ —Ñ–æ—Ä–º–∞—Ç –ø–æ—Å—Ç–∞ –í–ö–æ–Ω—Ç–∞–∫—Ç–µ –¥–ª—è —Å–æ–æ–±—â–µ—Å—Ç–≤–∞ 5 –≤—ë—Ä—Å—Ç.\n"
            "–ú–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å —Ç–µ–∫—Å—Ç –Ω–µ–º–Ω–æ–≥–æ –¥–ª–∏–Ω–Ω–µ–µ, –¥–æ–±–∞–≤–∏—Ç—å –≤–æ–ø—Ä–æ—Å—ã –∫ –∞—É–¥–∏—Ç–æ—Ä–∏–∏ –∏ –º—è–≥–∫–∏–µ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è "
            "–æ—Å—Ç–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π, –ø–æ–¥–µ–ª–∏—Ç—å—Å—è —Ñ–æ—Ç–æ, –æ—Ç–º–µ—Ç–∏—Ç—å –¥—Ä—É–∑–µ–π.\n"
            "–°–æ—Ö—Ä–∞–Ω–∏ —Ç–æ–Ω: –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π, –ø—Ä–æ—Å—Ç–æ–π, –±–µ–∑ —Å–ø–æ—Ä—Ç–∏–≤–Ω–æ–≥–æ –ø–∞—Ñ–æ—Å–∞.\n"
            "–ù–µ –¥–æ–±–∞–≤–ª—è–π —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ—á–Ω—ã—Ö —Å–æ–≤–µ—Ç–æ–≤ –∏ –Ω–µ –ø—Ä–µ–≤—Ä–∞—â–∞–π —ç—Ç–æ –≤ —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏–µ.\n\n"
            f"–ò—Å—Ö–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç:\n{content}"
        )
    else:
        instruction = (
            "–ù–µ–º–Ω–æ–≥–æ —É–ª—É—á—à–∏—Ç–µ –∏ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —ç—Ç–æ—Ç —Ç–µ–∫—Å—Ç, —Å–æ—Ö—Ä–∞–Ω–∏–≤ —Å—Ç–∏–ª—å –¥–≤–∏–∂–µ–Ω–∏—è 5 –≤—ë—Ä—Å—Ç.\n\n"
            f"–¢–µ–∫—Å—Ç:\n{content}"
        )

    return await _call_openai(instruction, max_tokens=800, temperature=0.6)
