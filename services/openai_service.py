async def generate_post(
    topic: str,
    post_type: str = "announcement",
    platform: str = "telegram",
) -> str:
    """
    Генерация поста для /create_post и кнопок.
    Структура как в примерах:
    **Заголовок:**
    **Основной текст:**
    **CTA:**
    **Хештеги:**
    """
    type_map = {
        "volunteer_call": "пост-набор волонтёров",
        "event_announcement": "анонс субботнего мероприятия или праздника",
        "event_report": "короткий отчёт о том, как всё прошло",
        "community_story": "история участника, волонтёра или локации",
        "info": "информационный пост о формате 5 вёрст",
        "announcement": "анонс субботней встречи 5 вёрст",
    }

    platform_hint = (
        "для Telegram: короче, структурировано, можно использовать эмодзи"
        if platform == "telegram"
        else "для ВКонтакте: можно писать чуть подробнее, добавить вопросы и приглашение к комментариям"
    )

    user_content = (
        "Сгенерируй текст для сообщества движения «5 вёрст».\n"
        f"Тип поста: {type_map.get(post_type, 'пост для сообщества 5 вёрст')}.\n"
        f"Площадка: {platform}. Подсказка по стилю: {platform_hint}.\n\n"
        f"Тема/контекст: {topic}\n\n"
        "СТРОГО СОБЛЮДАЙ СЛЕДУЮЩУЮ СТРУКТУРУ (как в примерах):\n\n"
        "**Заголовок:** одна короткая строка.\n\n"
        "**Основной текст:** 2–4 абзаца простым, дружелюбным языком.\n"
        "Можно использовать эмодзи, но умеренно.\n\n"
        "**CTA:** 1–2 понятных призыва к действию (написать в комментариях, прийти в субботу,\n"
        "записаться волонтёром, поделиться фото).\n\n"
        "**Хештеги:** 1 строка с хештегами вида #5верст и по необходимости локация/тема.\n\n"
        "Не добавляй других разделов и заголовков, только эти четыре блока."
    )

    max_tokens = 400 if platform == "telegram" else 800
    return await _call_openai(user_content, max_tokens=max_tokens, temperature=0.7)
